# 2026-02-15 — Feature Completion & Polish

Continued from Feb 14 where Phases 1-7 were implemented. Today's work focused on
filling implementation gaps, adding frontend tests, and fixing broken functionality.

## Commits

| Hash | Description |
|------|-------------|
| `07ba918` | Add Vitest frontend tests for Vue composables and Pinia stores |
| `c08a751` | Add profile management and admin stats endpoints |
| `965376c` | Add password change endpoint and guest-to-user conversion flow |

## Vitest Frontend Tests (76 tests)

Created 5 test files covering all Vue composables and Pinia stores:

| Test File | Tests | Key Coverage |
|-----------|-------|--------------|
| `useI18n.test.js` | 6 | Translation, locale toggle, persistence |
| `useDarkMode.test.js` | 7 | System preference, toggle, class/localStorage sync |
| `authStore.test.js` | 22 | All auth flows, computed props, storage |
| `gameStore.test.js` | 34 | State machine, API calls, WebSocket lifecycle |
| `soundStore.test.js` | 7 | Enable/disable, volume, localStorage |

**Testing patterns established:**
- `vi.resetModules()` + dynamic `import()` for module-level Vue refs
- `await nextTick()` after mutations to assert Vue watcher side-effects
- `vi.mock()` for API, WebSocket, and sound store modules
- `createPinia()` / `setActivePinia()` for store isolation

## New API Endpoints

### Profile Management
| Method | Route | Purpose |
|--------|-------|---------|
| `PATCH` | `/api/v1/profile/nickname` | Update nickname (3-20 chars, unique) |
| `PATCH` | `/api/v1/profile/password` | Change password (requires current_password) |
| `DELETE` | `/api/v1/profile` | Delete account (Sanctum auth required) |

### Admin Stats
| Method | Route | Purpose |
|--------|-------|---------|
| `GET` | `/api/v1/admin/stats` | Server-side stats (players, games, active today, etc.) |

### New Files Created
- `UpdateNicknameRequest.php` — Validation with unique:players ignore-self
- `UpdatePasswordRequest.php` — current_password + confirmed rules
- `ProfileTest.php` — 10 tests covering nickname, password, delete

## Bugs Fixed

### 1. Password Change Was Broken
ProfileSettings.vue was calling `api.auth.resetPassword()` (the forgot-password flow)
instead of a proper authenticated password change endpoint. The reset endpoint expects
`token` + `email`, not `current_password`.

**Fix:** Created `PATCH /profile/password` with `UpdatePasswordRequest` that uses
Laravel's built-in `current_password` validation rule.

### 2. Guest-to-User Conversion Missing from Frontend
The backend `POST /auth/convert` endpoint existed but was never called from the frontend.
Guest players had no way to create an account while preserving their stats.

**Fix:**
- Added `convertGuest()` action to `authStore.js`
- Updated `Register.vue` to detect guest sessions and use convert flow
- Pre-fills nickname from guest session
- Shows conversion notice banner
- Hides "play as guest" section when already a guest

### 3. Admin Stats Were Hardcoded
Admin.vue stats tab showed `active_today: 0` and `games_today: 0` because it was
calculating from local data instead of a server endpoint.

**Fix:** Created `GET /admin/stats` endpoint returning 7 metrics from real DB queries.
Updated Admin.vue to load stats in parallel with players/games.

## Test Totals

| Suite | Tests | Assertions |
|-------|-------|------------|
| PHPUnit (backend) | 154 passed, 1 skipped | 716 |
| Vitest (frontend) | 76 passed | — |
| **Total** | **230** | — |

## Status

All 7 phases of SELECT-PLAN.md are fully implemented and tested. The web app is
feature-complete with no known broken endpoints or UI flows.

**Remaining non-code work:**
- Replace placeholder MP3 sound files with real audio
- Deploy latest commits to production
